from base_plugin import BasePlugin, HookResult, HookStrategy
from android_utils import log
from settings import Header, Input

__id__ = "exteraphone"
__name__ = "Ð¡Ð¼Ð°Ñ€Ñ‚Ñ„Ð¾Ð½ exteraGram"
__description__ = "ÑÐ¼Ð°Ñ€Ñ‚Ñ„Ð¾Ð½ exteraGram. Ð¤Ð¾Ñ€ÐºÐ½ÑƒÑ‚Ð¾ Ñ @mochaplugins 'vivomod'"
__author__ = "@nijon4rch"
__min_version__ = "11.9.0"
__icon__ = "nixter4jon/2"
__version__ = "1.0.1"

class VivoPlugin(BasePlugin):
    def create_settings(self):
        from java.util import Locale
        lang = Locale.getDefault().getLanguage()
        strings = {
            'ru': {
                'aptext_text': "Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚",
                'aptext_desc': "Ð­Ñ‚Ð¾Ñ‚ Ñ‚ÐµÐºÑÑ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ð² ÐºÐ¾Ð½ÐµÑ† ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"
            },
            'en': {
                'aptext_text': "Appended text",
                'aptext_desc': "This text will be appended at the end of every message"
            }
        } 

        lang_key = 'ru' if lang.startswith('ru') else 'en'
        s = strings[lang_key]

        return [
            Header(text="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ð»Ð°Ð³Ð¸Ð½Ð°"),
            Input(
                key="append_text",
                text=s['aptext_text'],
                default="Ð¡Ð¼Ð°Ñ€Ñ‚Ñ„Ð¾Ð½ exteraGram",
                subtext=s['aptext_desc']
            ),
        ]

    def on_send_message_hook(self, account, params) -> HookStrategy:
        try:
            if not isinstance(params.message, str):
                return HookResult()

            if params.message.startswith(".noep "):
                params.message = params.message[6:].lstrip()
                return HookResult(strategy=HookStrategy.MODIFY, params=params)
            elif params.message.endswith(" .noep"):
                params.message = params.message[:-6].lstrip()
                return HookResult(strategy=HookStrategy.MODIFY, params=params)
            elif params.message.startswith("ðŸŽ°"):
                return HookResult()

            append_text = self.get_setting("append_text", "Ð¡Ð¼Ð°Ñ€Ñ‚Ñ„Ð¾Ð½ exteraGram").strip()
            params.message = params.message + "\n" + append_text
            
            return HookResult(strategy=HookStrategy.MODIFY, params=params)
        except Exception as e:
            log(f"DonoMod plugin error: {str(e)}")
            return HookResult() 
